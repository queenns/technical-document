# Prometheus

## 目标
* 长期趋势分析: 通过监控样本数据得收集和统计，对监控指标进行长期趋势分析
* 对照分析: 多个版本系统运行资源的差异，并发和负载变化等
* 告警: 系统出现或即将出现故障时，监控系统迅速通知，预防和快速定位问题
* 故障分析与定位: 故障发生对问题进行调查和处理，不同监控和历史数据得分析，定位问题根源
* 数据可视化: 可视化仪表盘直观获取运行状态，资源使用情况得信息

## 常见监控系统对比
* Nagios: 系统性的，运维管理难度大，每台机器一个agent整体支持度不好
* Zabbix: 相对比较广泛，系统指标更强，php/mysql等环境
* Prometheus: 二进制包，只需要本地磁盘，pull/svc discovery，应用内部集成方便

## 数据模型
* 所有采集得监控数据均以指标(metric)形式保存在时间序列数据库(TSDB),按照时间先后顺序存储
```bash
http_request_status{code='200',content_path='/api/path', environment='produment'} => [value1@timestamp1,value2@timestamp2...]
```
Metrics Name{Labels} => [value1:timestamp1, value2:timestamp2]

## 查询语言
* PromQL: 查询聚合，应用于可视化

## 处理能力
* 大量得监控任务产生大量的监控数据
* 数以百万的监控指标
* 每秒处理数十万得数据点

## 可扩展
* 不同数据中心/独立运营得团队单独得Prometheus Server
* 集群，多个Server实例组成一个逻辑集群，分区+联邦集群

## 易集成
* Java, JMX，Node.js， Python，Go等等语言客户端，可扩展易扩展的
* 开源提供第三方实现的数据采集支持: JMX，CloudWatch，Mysql，SNMP，Redis，Consul等等

## Metric 类型
* Counter(计数器)
只增不减，除非系统发生重置，例如：http请求个数

* Gauge(仪表盘)
可增可减，例如：可用内存大小

* Histogram(直方图)
样本的分布情况，服务器端计算

* Summary(摘要)
样本的分布情况，客户端计算

## 黄金指标
* 延迟
* 1.服务请求所需时间
* 2.链路中各种服务细分(长久持续规划方向)
* 3.服务各状态区分，在快速失败得微服务中延迟指标可能需要转向响应码

* 通讯量
* 1.系统流量，衡量服务容量需求，例如：Http每秒请求数

* 错误
* 1.系统发生错误得请求量
* 2.显示错误:500，隐式错误:200，但是业务失败/异常

* 饱和度
* 1.服务受限的各种资源，内存/磁盘IO等

## RED指标
* 请求速率: 服务每秒接收得请求数
* 请求错误: 每秒失败得请求数
* 请求耗时: 每个请求的耗时
